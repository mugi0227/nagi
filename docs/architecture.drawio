<mxfile host="65bd71144e">
    <diagram id="nagi-architecture" name="nagi アーキテクチャ">
        <mxGraphModel dx="922" dy="511" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="nagi - 自律型秘書AI アーキテクチャ図" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=20;fontStyle=1;fontColor=#333333;" parent="1" vertex="1">
                    <mxGeometry x="500" y="20" width="400" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="client-group" value="クライアント層" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#9C27B0;verticalAlign=top;fontStyle=1;fontSize=14;arcSize=8;dashed=1;dashPattern=5 5;" parent="1" vertex="1">
                    <mxGeometry x="180" y="80" width="1040" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="web-browser" value="&lt;b&gt;Webブラウザ&lt;/b&gt;&lt;br&gt;React 19 + Vite&lt;br&gt;ダッシュボード / チャット / タスク管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#9C27B0;fontSize=12;verticalAlign=middle;arcSize=12;" parent="1" vertex="1">
                    <mxGeometry x="220" y="120" width="260" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="chrome-ext" value="&lt;b&gt;Chrome拡張機能&lt;/b&gt;&lt;br&gt;サイドパネルチャット&lt;br&gt;ブラウザ自動操作 (RPA)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#9C27B0;fontSize=12;verticalAlign=middle;arcSize=12;" parent="1" vertex="1">
                    <mxGeometry x="560" y="120" width="260" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="native-ptt" value="&lt;b&gt;Native PTTアプリ&lt;/b&gt;&lt;br&gt;(Windows)&lt;br&gt;音声入力 (Push-to-Talk)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#9C27B0;fontSize=12;verticalAlign=middle;arcSize=12;" parent="1" vertex="1">
                    <mxGeometry x="900" y="120" width="260" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-web" value="HTTPS / SSE" style="endArrow=classic;startArrow=classic;html=1;strokeColor=#666666;fontSize=11;fontColor=#666666;entryX=0.3;entryY=0;entryDx=0;entryDy=0;" parent="1" source="web-browser" target="vm-group" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-chrome" value="HTTPS / SSE" style="endArrow=classic;startArrow=classic;html=1;strokeColor=#666666;fontSize=11;fontColor=#666666;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="chrome-ext" target="vm-group" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-ptt" value="HTTPS" style="endArrow=classic;startArrow=classic;html=1;strokeColor=#666666;fontSize=11;fontColor=#666666;entryX=0.7;entryY=0;entryDx=0;entryDy=0;" parent="1" source="native-ptt" target="vm-group" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="vm-group" value="VMインスタンス (Google Compute Engine)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;verticalAlign=top;fontStyle=1;fontSize=14;arcSize=6;strokeWidth=2;" parent="1" vertex="1">
                    <mxGeometry x="160" y="310" width="1080" height="500" as="geometry"/>
                </mxCell>
                <mxCell id="nginx" value="&lt;b&gt;Nginx&lt;/b&gt;&lt;br&gt;リバースプロキシ / TLS終端 (Let&#39;s Encrypt)&lt;br&gt;nagiai.dev (HTTPS :443)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1565C0;fontSize=12;arcSize=10;" parent="1" vertex="1">
                    <mxGeometry x="450" y="350" width="500" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="frontend" value="&lt;b&gt;フロントエンド&lt;/b&gt;&lt;br&gt;React 19 + TypeScript + Vite&lt;br&gt;ポート 5173" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#2E7D32;fontSize=12;arcSize=10;" parent="1" vertex="1">
                    <mxGeometry x="200" y="450" width="240" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="backend-group" value="バックエンド (FastAPI + Google ADK)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#E65100;verticalAlign=top;fontStyle=1;fontSize=13;arcSize=6;dashed=1;dashPattern=5 5;" parent="1" vertex="1">
                    <mxGeometry x="500" y="430" width="700" height="350" as="geometry"/>
                </mxCell>
                <mxCell id="api-router" value="&lt;b&gt;API Router&lt;/b&gt;&lt;br&gt;REST + SSE ストリーミング&lt;br&gt;ポート 8000" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#E65100;fontSize=11;arcSize=10;" parent="1" vertex="1">
                    <mxGeometry x="520" y="470" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="auth" value="&lt;b&gt;認証&lt;/b&gt;&lt;br&gt;OIDC / Local JWT" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#E65100;fontSize=11;arcSize=10;" parent="1" vertex="1">
                    <mxGeometry x="740" y="470" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="agent-service" value="&lt;b&gt;エージェントサービス&lt;/b&gt;&lt;br&gt;(Google ADK)&lt;br&gt;秘書エージェント / 課題エージェント&lt;br&gt;70+ ツール / プロンプト層別化" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCC80;strokeColor=#E65100;fontSize=11;arcSize=10;" parent="1" vertex="1">
                    <mxGeometry x="520" y="560" width="250" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="biz-services" value="&lt;b&gt;ビジネスサービス&lt;/b&gt;&lt;br&gt;タスク / プロジェクト / 会議&lt;br&gt;スケジュール / 通知 / 実績" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCC80;strokeColor=#E65100;fontSize=11;arcSize=10;" parent="1" vertex="1">
                    <mxGeometry x="800" y="560" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="scheduler" value="&lt;b&gt;バックグラウンド&lt;br&gt;スケジューラ&lt;/b&gt;&lt;br&gt;(APScheduler)&lt;br&gt;Top3推薦 / ハートビート&lt;br&gt;定期リマインダー" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCC80;strokeColor=#E65100;fontSize=11;arcSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1040" y="470" width="140" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="stt-local" value="&lt;b&gt;音声処理&lt;/b&gt;&lt;br&gt;文字起こし&lt;br&gt;(STTプロバイダー)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCC80;strokeColor=#E65100;fontSize=11;arcSize=10;" parent="1" vertex="1">
                    <mxGeometry x="900" y="470" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="repo-layer" value="&lt;b&gt;リポジトリ層&lt;/b&gt;&lt;br&gt;(Clean Architecture)&lt;br&gt;インターフェース抽象化" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#E65100;fontSize=11;arcSize=10;" parent="1" vertex="1">
                    <mxGeometry x="520" y="670" width="480" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-nginx-fe" value="/" style="endArrow=classic;html=1;strokeColor=#2E7D32;fontSize=10;fontColor=#2E7D32;" parent="1" source="nginx" target="frontend" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-nginx-be" value="/api" style="endArrow=classic;html=1;strokeColor=#E65100;fontSize=10;fontColor=#E65100;" parent="1" source="nginx" target="api-router" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-api-agent" style="endArrow=classic;html=1;strokeColor=#999999;" parent="1" source="api-router" target="agent-service" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-api-auth" style="endArrow=classic;html=1;strokeColor=#999999;" parent="1" source="api-router" target="auth" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-agent-biz" style="endArrow=classic;html=1;strokeColor=#999999;" parent="1" source="agent-service" target="biz-services" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-agent-repo" style="endArrow=classic;html=1;strokeColor=#999999;" parent="1" source="agent-service" target="repo-layer" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-biz-repo" style="endArrow=classic;html=1;strokeColor=#999999;" parent="1" source="biz-services" target="repo-layer" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-api-stt" style="endArrow=classic;html=1;strokeColor=#999999;" parent="1" source="api-router" target="stt-local" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="sqlite" value="&lt;b&gt;SQLite&lt;/b&gt;&lt;br&gt;secretary.db" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#BBDEFB;strokeColor=#1565C0;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="210" y="580" width="120" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="local-storage" value="&lt;b&gt;ローカル&lt;br&gt;ストレージ&lt;/b&gt;&lt;br&gt;/storage/" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#BBDEFB;strokeColor=#1565C0;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="360" y="580" width="110" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-repo-sqlite" style="endArrow=classic;html=1;strokeColor=#1565C0;" parent="1" source="repo-layer" target="sqlite" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-repo-storage" style="endArrow=classic;html=1;strokeColor=#1565C0;" parent="1" source="repo-layer" target="local-storage" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="google-group" value="Google Cloud サービス" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#1B5E20;verticalAlign=top;fontStyle=1;fontSize=14;arcSize=6;strokeWidth=2;dashed=1;dashPattern=8 8;" parent="1" vertex="1">
                    <mxGeometry x="160" y="890" width="1080" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="gemini-api" value="&lt;b&gt;Gemini API&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;gemini-3-pro/flash-preview&lt;br&gt;自然言語・画像処理 / タスク判断&lt;br&gt;ツール呼び出し / 対話生成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#A5D6A7;strokeColor=#1B5E20;fontSize=12;arcSize=10;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="220" y="930" width="240" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="google-stt" value="&lt;b&gt;Google Cloud&lt;br&gt;Speech-to-Text v2&lt;/b&gt;&lt;br&gt;&lt;br&gt;Chirp 3 モデル&lt;br&gt;日本語 / 多言語対応&lt;br&gt;音声文字起こし" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#A5D6A7;strokeColor=#1B5E20;fontSize=12;arcSize=10;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="560" y="930" width="240" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="future-gcp" value="&lt;b&gt;将来拡張（実装済み）&lt;/b&gt;&lt;br&gt;&lt;br&gt;Cloud Firestore&lt;br&gt;Cloud Storage (GCS)&lt;br&gt;Vertex AI&lt;br&gt;&lt;i&gt;※ENVIRONMENT=gcp で切替可&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#1B5E20;fontSize=11;arcSize=10;dashed=1;dashPattern=5 5;" parent="1" vertex="1">
                    <mxGeometry x="900" y="930" width="220" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-agent-gemini" value="LLM呼び出し&lt;br&gt;(API Key認証)" style="endArrow=classic;html=1;strokeColor=#1B5E20;fontSize=10;fontColor=#1B5E20;strokeWidth=2;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="agent-service" target="gemini-api" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow-stt-google" value="音声認識&lt;br&gt;(gRPC)" style="endArrow=classic;html=1;strokeColor=#1B5E20;fontSize=10;fontColor=#1B5E20;strokeWidth=2;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="stt-local" target="google-stt" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="legend-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FAFAFA;strokeColor=#CCCCCC;verticalAlign=top;arcSize=8;" parent="1" vertex="1">
                    <mxGeometry x="160" y="1120" width="600" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="legend-title" value="凡例" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=12;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="170" y="1120" width="50" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend-client" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#9C27B0;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="180" y="1155" width="20" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="legend-client-text" value="クライアント" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="205" y="1150" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend-vm" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1565C0;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="300" y="1155" width="20" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="legend-vm-text" value="VMインフラ" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="325" y="1150" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend-be" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#E65100;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="410" y="1155" width="20" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="legend-be-text" value="バックエンド" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="435" y="1150" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend-google" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#A5D6A7;strokeColor=#1B5E20;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="530" y="1155" width="20" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="legend-google-text" value="Google Cloud" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="555" y="1150" width="100" height="30" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>