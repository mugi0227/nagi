# マイグレーション/バックフィルスクリプト

既存データを新しいスキーマや機能に対応させるためのスクリプト一覧。

## 利用可能なスクリプト

### backfill_order_in_parent.py

サブタスクの `order_in_parent` フィールドをバックフィルするスクリプト。
依存関係と作成日時を考慮してサブタスクの順序を設定します。

```bash
cd backend
python scripts/backfill_order_in_parent.py
```

---

### backfill_subtask_assignees.py

**v1.x で追加** - サブタスクに親タスクの担当者を引き継ぐスクリプト。

#### 背景
サブタスク作成時に親タスクの担当者を自動的に引き継ぐ機能が追加されましたが、
この機能追加前に作成された既存のサブタスクには担当者が設定されていません。

#### 動作
1. 親タスクを持つすべてのサブタスクを取得
2. 各サブタスクについて、親タスクの担当者を確認
3. サブタスクにまだ割り当てられていない担当者がいれば追加

**注意**: 既にサブタスクに別の担当者がいる場合は、親タスクの担当者を追加で割り当てます（上書きではありません）。

```bash
cd backend
python scripts/backfill_subtask_assignees.py
```

#### 出力例
```
Created 15 assignee inheritances for subtasks.
```

---

## スクリプト実行時の注意事項

1. **バックアップを取る**: 本番環境で実行する前に必ずデータベースのバックアップを取得してください
2. **開発環境でテスト**: 本番適用前に開発環境で動作確認を行ってください
3. **冪等性**: 各スクリプトは複数回実行しても安全に設計されています（既に処理済みのデータはスキップ）
