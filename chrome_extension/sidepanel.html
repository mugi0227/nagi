<!DOCTYPE html>
<html>

<head>
    <title>Secretary Agent</title>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
</head>

<body>
    <div id="app">
        <header class="app-header">
            <div class="header-left">
                <div class="logo-glow"></div>
                <span class="logo-icon">AI</span>
                <div class="header-titles">
                    <h1 class="logo-text">Secretary Agent</h1>
                    <div class="status-wrap">
                        <div id="status" class="status-indicator online" title="Connected"></div>
                        <span class="status-text">Online</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <div class="approval-mode-toggle" role="group" aria-label="Approval mode">
                    <button id="approval-manual-btn" class="approval-mode-btn" title="Require approval for tool actions">
                        Manual
                    </button>
                    <button id="approval-auto-btn" class="approval-mode-btn active" title="Auto-run tool actions">
                        Auto
                    </button>
                </div>
                <button id="settings-btn" class="action-icon-btn" title="Connection Settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.18A1.65 1.65 0 0 0 10 3.09V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.18a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.18A1.65 1.65 0 0 0 21 10h.09a2 2 0 1 1 0 4H21a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </button>
                <button id="history-btn" class="action-icon-btn" title="Recent Chats">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                </button>
                <button id="new-chat-btn" class="action-icon-btn" title="New Chat">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"></path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- History Panel -->
        <div id="history-panel" class="history-panel hidden">
            <div class="panel-header">
                <h3>Recent Chats</h3>
                <button id="close-history" class="close-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div id="session-list" class="session-list">
                <div class="loading-item">Loading history...</div>
            </div>
        </div>

        <main id="chat-stream">
            <div id="messages" class="message-list">
                <!-- Messages will be injected here -->
                <div class="message assistant">
                    <div class="message-content">Hello, Shuhei! I'm your Secretary Agent. How can I help you today?
                    </div>
                </div>
                <div id="thinking" class="thinking-container hidden">
                    <div class="thinking-bubble">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <span class="thinking-text">Thinking...</span>
                </div>
            </div>
        </main>

        <section class="browser-panel">
            <div class="browser-panel-head">
                <span class="browser-title">Browser Agent</span>
                <span id="browser-agent-badge" class="browser-badge idle">Idle</span>
            </div>
            <div class="browser-panel-row">
                <input id="browser-goal-input" type="text"
                    placeholder="Example: Upload invoice PDF on this page" />
                <button id="browser-run-btn" class="mini-btn">Run</button>
                <button id="browser-stop-btn" class="mini-btn ghost" disabled>Stop</button>
            </div>
            <div class="browser-panel-row rpa-record-row">
                <button id="rpa-record-btn" class="mini-btn ghost">Record Demo</button>
                <button id="rpa-record-stop-btn" class="mini-btn ghost" disabled>Stop & Save Skill</button>
            </div>
            <details class="activity-panel">
                <summary>Agent Activity</summary>
                <div id="activity-log" class="activity-log"></div>
            </details>
        </section>

        <footer class="input-section">
            <section id="interaction-panel" class="interaction-panel hidden">
                <div id="proposal-panel" class="proposal-panel hidden">
                    <div class="proposal-panel-header">
                        <span id="proposal-type-badge" class="proposal-type-badge">Approval Required</span>
                        <div class="proposal-pagination">
                            <button id="proposal-prev-btn" class="proposal-nav-btn" type="button" title="Previous proposal">
                                &lt;
                            </button>
                            <span id="proposal-page-label" class="proposal-page-label">1 / 1</span>
                            <button id="proposal-next-btn" class="proposal-nav-btn" type="button" title="Next proposal">
                                &gt;
                            </button>
                        </div>
                    </div>
                    <div class="proposal-panel-body">
                        <p id="proposal-description" class="proposal-description"></p>
                        <pre id="proposal-payload" class="proposal-payload"></pre>
                    </div>
                    <div id="proposal-error" class="proposal-error hidden"></div>
                    <div class="proposal-actions-row">
                        <button id="proposal-reject-btn" class="mini-btn ghost" type="button">Reject</button>
                        <button id="proposal-approve-btn" class="mini-btn" type="button">Approve</button>
                    </div>
                    <div class="proposal-actions-row all">
                        <button id="proposal-reject-all-btn" class="mini-btn ghost" type="button">Reject All</button>
                        <button id="proposal-approve-all-btn" class="mini-btn" type="button">Approve All</button>
                    </div>
                </div>

                <div id="questions-panel" class="questions-panel hidden">
                    <div class="questions-panel-header">
                        <span class="questions-title">Agent Needs Input</span>
                    </div>
                    <p id="questions-context" class="questions-context hidden"></p>
                    <div id="questions-list" class="questions-list"></div>
                    <div class="questions-actions">
                        <button id="questions-cancel-btn" class="mini-btn ghost" type="button">Cancel</button>
                        <button id="questions-submit-btn" class="mini-btn" type="button" disabled>Send Answers</button>
                    </div>
                </div>
            </section>
            <div id="preview-container" class="hidden">
                <div class="preview-card">
                    <img id="screenshot-preview" src="" alt="Screenshot">
                    <div id="file-preview-badge" class="file-preview-badge hidden">PDF</div>
                    <button id="remove-screenshot" class="remove-btn">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="3">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                    <div class="preview-info">
                        <span id="preview-type" class="preview-type">Screenshot</span>
                    </div>
                </div>
            </div>

            <div class="input-box-wrapper">
                <div class="input-actions-left">
                    <input id="file-upload-input" type="file" accept="image/*,application/pdf" class="hidden" />
                    <button id="upload-file-btn" class="input-action-btn" title="Upload image or PDF">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M21.44 11.05l-8.49 8.49a5 5 0 0 1-7.07-7.07l8.49-8.49a3.5 3.5 0 0 1 4.95 4.95l-8.49 8.49a2 2 0 0 1-2.83-2.83l7.78-7.78" />
                        </svg>
                    </button>
                    <button id="capture-btn" class="input-action-btn" title="Capture Tab">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                            <circle cx="12" cy="13" r="4" />
                        </svg>
                    </button>
                </div>
                <textarea id="user-input" placeholder="Type a message..." rows="1"></textarea>
                <div class="input-actions-right">
                    <button id="send-btn" class="send-action-btn" title="Send" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13" />
                            <polygon points="22 2 15 22 11 13 2 9 22 2" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="legal-footer">
                Secretary Agent may make mistakes.
            </div>
        </footer>
    </div>

    <div id="settings-panel" class="settings-panel hidden">
        <div class="panel-header">
            <h3>Connection Settings</h3>
            <button id="close-settings" class="close-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="settings-content">
            <label class="setting-field">
                <span>App Base URL</span>
                <input id="app-base-url" type="url" placeholder="https://app.example.com" />
            </label>
            <label class="setting-field">
                <span>API Base URL</span>
                <input id="api-base-url" type="url" placeholder="https://api.example.com/api" />
            </label>
            <label class="setting-field">
                <span>Auth Mode</span>
                <select id="auth-mode">
                    <option value="bearer">Bearer Token</option>
                    <option value="cookie">Use App Login Session (Auto Token)</option>
                </select>
            </label>
            <label id="token-field" class="setting-field">
                <span>Access Token</span>
                <input id="access-token" type="password" placeholder="JWT or dev_user" />
            </label>
            <label class="setting-field">
                <span>Browser Provider</span>
                <select id="browser-provider">
                    <option value="gemini_direct">Gemini API (Direct)</option>
                    <option value="bedrock_direct">AWS Bedrock (Direct)</option>
                    <option value="litellm">LiteLLM</option>
                </select>
            </label>
            <label class="setting-field">
                <span>Browser Model</span>
                <input id="browser-model" type="text" placeholder="gemini-2.5-flash" />
            </label>
            <label id="browser-api-key-field" class="setting-field">
                <span>Browser LLM API Key</span>
                <input id="browser-api-key" type="password" placeholder="Gemini/LiteLLM token" />
            </label>
            <label id="browser-api-base-url-field" class="setting-field">
                <span>Browser LiteLLM Base URL</span>
                <input id="browser-api-base-url" type="url" placeholder="http://localhost:4000" />
            </label>
            <label id="browser-bedrock-region-field" class="setting-field hidden">
                <span>Bedrock Region</span>
                <input id="browser-bedrock-region" type="text" placeholder="us-east-1" />
            </label>
            <label id="browser-bedrock-access-key-field" class="setting-field hidden">
                <span>Bedrock Access Key ID</span>
                <input id="browser-bedrock-access-key-id" type="text" placeholder="AKIA..." />
            </label>
            <label id="browser-bedrock-secret-key-field" class="setting-field hidden">
                <span>Bedrock Secret Access Key</span>
                <input id="browser-bedrock-secret-access-key" type="password" placeholder="Secret access key" />
            </label>
            <label id="browser-bedrock-session-token-field" class="setting-field hidden">
                <span>Bedrock Session Token (Optional)</span>
                <input id="browser-bedrock-session-token" type="password" placeholder="STS session token" />
            </label>
            <div class="settings-actions">
                <button id="save-settings-btn" class="mini-btn">Save</button>
                <button id="test-connection-btn" class="mini-btn ghost">Test</button>
                <button id="open-login-btn" class="mini-btn ghost">Open Login</button>
            </div>
            <p id="settings-hint" class="settings-hint"></p>
        </div>
    </div>
    <script src="sidepanel.js"></script>
</body>

</html>

